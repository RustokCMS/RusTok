# Agent Execution Guide: Admin Migration Plan

Практическая инструкция для агента, который реализует план миграции админки.

## 0) Цель и приоритет

Цель: быстро получить рабочую админку с корректными auth/RBAC/navigation и без разъезда между Next и Leptos.

Приоритет выполнения:

1. Auth + роли + навигация.
2. Адаптация готовых страниц starter.
3. Таблицы и тяжелые data workflows.

## 1) Документы, которые читать в начале каждой сессии

Обязательный порядок чтения:

1. `docs/UI/admin-template-migration.md` — основной план и порядок фаз.
2. `docs/UI/admin-libraries-parity.md` — паритет библиотек и gap-лог.
3. `docs/UI/admin-server-connection-quickstart.md` — запуск/подключение окружения.
4. `docs/UI/rust-ui-component-catalog.md` — snapshot компонентов Rust/UI.
5. `IU/docs/api-contracts.md` — контракт компонентов при выносе в shared слой.

Если задача связана с Rust/UI:

- использовать `docs/UI/tools/rust_ui_catalog_parser.py` и `docs/UI/rust-ui-nav-snapshot.txt` для обновления локального каталога.

## 2) Что именно делать агенту

На каждую задачу агент выполняет цикл:

1. Сверяет задачу с фазой из `admin-template-migration.md`.
2. Проверяет библиотечный паритет и gap-лог в `admin-libraries-parity.md`.
3. Определяет целевой слой реализации:
   - `crates/*` (предпочтительно для shared/domain логики),
   - `apps/next-admin` и `apps/admin` только для screen composition.
4. Делает изменение в Next и Leptos параллельно (или создает parity-task в этом же PR).
5. Обновляет документацию (статус/gap/решение), если изменился стек или архитектурное решение.

## 3) Что заполнять/обновлять в документах

Агент обязан обновлять:

- `docs/UI/admin-libraries-parity.md`:
  - статус `covered/partial/gap`,
  - решение `adopt/pilot/reject`,
  - `target crate`, `owner`, `fallback`.
- `docs/UI/rust-ui-component-catalog.md`:
  - Decision и Target shared crate по компонентам, которые затронул PR.
- `docs/UI/admin-template-migration.md`:
  - если изменился порядок фаз, dependency policy или workflow-правила.

## 4) Жесткие правила (обязательно)

1. **Не удалять библиотеки без явного разрешения владельца/ревьюера.**
2. Если библиотека не работает:
   - сначала фиксируем проблему (лог, версия, repro),
   - проверяем совместимость,
   - предлагаем интеграционный фикс,
   - и только потом RFC/issue на замену.
3. Не делать ad-hoc самопис в `apps/*`, если это должно жить в shared crate.
4. Rust/UI не считать прямой dependency-заменой: это reference/инструкции, код переносится в наши `crates/*`.

## 5) Спорные вопросы

Если есть двусмысленность (архитектура, библиотека, поведение, UX parity):

1. Остановить внедрение спорной части.
2. Сформулировать 2–3 варианта с trade-offs.
3. Запросить уточнение у владельца задачи.
4. До ответа — не принимать необратимых решений (удаление библиотеки, массовый рефакторинг, смена контракта API).

## 6) Definition of Done для задачи агента

Задача считается завершенной, если:

1. Реализация соответствует текущей фазе плана.
2. Нет незафиксированного разъезда Next ↔ Leptos.
3. Обновлены соответствующие документы (паритет/каталог/gap-log).
4. Все изменения закоммичены отдельным понятным commit message.
5. Создан новый PR (если текущий PR не может быть обновлен из Codex-сессии).

## 7) Формат отчета агента в конце

В финальном отчете агент обязан указать:

- что изменено (код + документы),
- какие команды проверки запускались,
- что осталось как риск/ограничение,
- какие решения требуют подтверждения владельца.
